# 查看后台数据 & 任意仓库都记录

## 一、后台数据去哪里看

### 1. 文件（原始数据）

- **对话原始数据**（当前所有对话都在一个文件里）  
  `backend/data/dialogues/current.json`

- **每日总结**（按日期一个文件）  
  `backend/data/summaries/`  
  例如：`2026-01-26.md`、`2026-01-29.md`

### 2. 接口（后端跑在 3001 时）

| 说明           | 方法 | 地址 |
|----------------|------|------|
| 所有对话       | GET  | `http://localhost:3001/api/dialogues` |
| 某天的对话     | GET  | `http://localhost:3001/api/dialogues/2026-01-28` |
| 统计（按日期） | GET  | `http://localhost:3001/api/stats` |
| 会话列表       | GET  | `http://localhost:3001/api/conversations` |
| 仓库列表       | GET  | `http://localhost:3001/api/repositories` |

### 3. 网页

- **对话列表**：http://localhost:3000  
- **每日总结**：http://localhost:3000/summaries  

---

## 二、为什么「别的仓库」的 Cursor 记录获取不到？

当前 Hook 是**项目级**的，只在本仓库生效：

- 配置文件在本仓库里：`.cursor/hooks.json`
- Cursor 只会在「当前打开的项目」里找 `.cursor/hooks.json` 并执行里面的脚本
- 所以：**只有打开「本仓库」（cursor-dialogue-recorder）时，对话才会被记录**
- 你用 Cursor 打开别的仓库时，那个仓库没有我们的 Hook，**自然获取不到那边的 Cursor 记录**

要想**不管打开哪个仓库，对话都记录到本网站**，需要改成**用户级 Hook**。

---

## 三、让「任意仓库」的对话都记录到本网站（用户级 Hook）

用户级 Hook 放在**用户目录** `~/.cursor/`，对**所有用 Cursor 打开的仓库**生效。

### 一键安装（推荐）

在**本仓库根目录**执行：

```bash
node scripts/install-user-hooks.js
```

脚本会：

1. 把 `record-dialogue.sh` 复制到 `~/.cursor/hooks/`
2. 在 `~/.cursor/` 下生成 `hooks.json`，指向该脚本

然后**重启 Cursor**。之后在**任意仓库**里用 Cursor 提问，对话都会发到本网站后端（需保证后端在跑，默认 `http://localhost:3001`）。

### 手动安装

1. 创建目录：`mkdir -p ~/.cursor/hooks`
2. 复制脚本：  
   `cp .cursor/hooks/record-dialogue.sh ~/.cursor/hooks/`  
   `chmod +x ~/.cursor/hooks/record-dialogue.sh`
3. 在 `~/.cursor/hooks.json` 里写入（用户级下命令相对 `~/.cursor/`）：

```json
{
  "version": 1,
  "hooks": {
    "beforeSubmitPrompt": [
      { "command": "./hooks/record-dialogue.sh beforeSubmitPrompt", "timeout": 5 }
    ],
    "afterAgentResponse": [
      { "command": "./hooks/record-dialogue.sh afterAgentResponse", "timeout": 5 }
    ]
  }
}
```

4. 重启 Cursor。

### 后端不在本机或端口不是 3001

在环境里设置（例如写进 `~/.zshrc` 或 `~/.bashrc`）：

```bash
export CURSOR_DIALOGUE_API_BASE=http://你的地址:端口/api
```

Hook 脚本里会用这个变量发请求。

---

## 四、对比小结

| 方式       | 配置位置        | 生效范围           |
|------------|-----------------|--------------------|
| 项目级 Hook | 本仓库 `.cursor/` | 仅打开本仓库时记录 |
| 用户级 Hook | `~/.cursor/`     | 任意仓库都会记录   |

装好用户级 Hook 后，昨天、今天在**别的仓库**用 Cursor 问的问题，只要后端在跑，都会记到 `backend/data/dialogues/current.json`，并可在网页和接口里按日期/会话/仓库查看。
